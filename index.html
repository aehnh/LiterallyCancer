<!DOCTYPE html>
<html>
    <head>
        <title>Literally Canvas</title>
        <link href="/static/css/literallycanvas.css" rel="stylesheet">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no" />

        <style type="text/css">
            *{
                margin: 0;
                padding: 0;
             }

            .fs-container {
                position: absolute;
                width: 100%;
                height: 100%;
                overflow: hidden;
            }

            .literally {
                width: 100%;
                height: 100%;
                position: relative;
            }

            #lc {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>

    <body>
        <div class="fs-container">
            <div id="lc"></div>
        </div>

<!-- you really ought to include react-dom, but for react 0.14 you don't strictly have to. -->
<script src="/static/js/react-0.14.3.js"></script>
<script src="/static/js/literallycanvas.js"></script>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

<script type="text/javascript">
    var socket = io();
    var lc = LC.init(document.getElementById("lc"), {
        imageURLPrefix: '/static/img',
        toolbarPosition: 'bottom',
        defaultStrokeWidth: 2,
        strokeWidths: [1, 2, 3, 5, 30],
        imageSize: {width: null, height: null}
    });
    lc.on('shapeSave', function(args) {
        console.log(JSON.stringify(args));
        console.log(LC.shapeToJSON(args.shape));
        console.log(JSON.stringify(args.previousShapeId));
        socket.emit('json shape', {
            curr: LC.shapeToJSON(args.shape),
            prev: args.previousShapeId
        });
    });
    lc.on('clear', function() {
        socket.emit('command', 'clear');
    });
    const unsubscribe = lc.on('undo', function() {
        socket.emit('command', 'undo');
    });
    lc.on('redo', function() {
        socket.emit('command', 'redo');
    });
    lc.on('backgroundColorChange', function(newColor) {

    });
    socket.on('json snapshot', function(msg) {
        console.log(msg);
        lc.loadSnapshot(JSON.parse(msg));
    });
    socket.on('json shape', function(args) {
        console.log(LC.JSONToShape(args.curr));
        console.log(args.prev);
        lc.saveShape(LC.JSONToShape(args.curr), false, args.prev);
    });
    socket.on('command', function(comm) {
        if(comm == 'clear') {
            console.log('clear');
            lc.clear(false);
        } else if(comm == 'undo') {
            console.log('undo');
            unsubscribe();
            lc.undo();
            const unsubscribe = lc.on('undo', function() {
                socket.emit('command', 'undo');
            });
        } else if(comm == 'redo') {
            console.log('redo');
            lc.redo(false);
        }
    });
</script>
</body>
</html>
